
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ‰ í…Œë¯¸ì™€ ê°€ìœ„ë°”ìœ„ë³´ ì±Œë¦°ì§€!</title>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #d0eaff, #ffffff);
      text-align: center;
      padding: 20px;
    }
    h1 {
      color: #004080;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    #start-button, #retry-button {
      padding: 20px 40px;
      font-size: 1.8em;
      border: none;
      background-color: #ff6600;
      color: white;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 30px;
      box-shadow: 0px 5px 10px rgba(0,0,0,0.2);
    }
    #game-area {
      display: none;
      margin-top: 30px;
    }
    .column {
      display: inline-block;
      vertical-align: top;
      width: 45%;
      margin: 2%;
    }
    canvas {
      border: 4px solid #ff9933;
      border-radius: 10px;
    }
    #gesture, #temi-choice, #result, #countdown, #scoreboard {
      font-size: 1.6em;
      margin-top: 20px;
      color: #333333;
      font-weight: bold;
    }
    #result {
      font-size: 2em;
      margin-top: 30px;
    }
    #game-title {
      background: #ffcc00;
      padding: 10px;
      font-size: 1.2em;
      border-radius: 10px;
      display: inline-block;
      margin-bottom: 20px;
      color: #333;
      box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="game-title">ğŸ“¢ ì´ë²¤íŠ¸ ì°¸ì—¬í•˜ê³  ì„ ë¬¼ ë°›ì!</div>
  <h1>ğŸ‰ í…Œë¯¸ì™€ ê°€ìœ„ë°”ìœ„ë³´ ì±Œë¦°ì§€</h1>
  <button id="start-button" onclick="startGame()">ê²Œì„ START</button>

  <div id="game-area">
    <div id="countdown">â³ ì¤€ë¹„ ì¤‘...</div>
    <div class="column">
      <h2>ğŸ¤– í…Œë¯¸</h2>
      <div id="temi-choice">ğŸ² ëŒ€ê¸° ì¤‘...</div>
    </div>
    <div class="column">
      <h2>ğŸ§â€â™‚ï¸ ë‹¹ì‹ </h2>
      <video id="input_video" style="display:none;"></video>
      <canvas id="output_canvas" width="640" height="480"></canvas>
      <div id="gesture">ğŸ– ì† ëª¨ì–‘ ì¸ì‹ ì¤‘...</div>
    </div>
    <div id="result">ğŸ¯ ê²°ê³¼: ëŒ€ê¸° ì¤‘...</div>
    <div id="scoreboard">ğŸ‘¤ ë‹¹ì‹ : 0ìŠ¹ / ğŸ¤– í…Œë¯¸: 0ìŠ¹</div>
    <button id="retry-button" onclick="retryGame()" style="display:none;">ğŸ” ë‹¤ì‹œ ë„ì „!</button>
  </div>

  <script>
    const videoElement = document.getElementById('input_video');
    const canvasElement = document.getElementById('output_canvas');
    const canvasCtx = canvasElement.getContext('2d');
    const gestureOutput = document.getElementById('gesture');
    const temiOutput = document.getElementById('temi-choice');
    const resultOutput = document.getElementById('result');
    const countdownEl = document.getElementById('countdown');
    const gameArea = document.getElementById('game-area');
    const startButton = document.getElementById('start-button');
    const retryButton = document.getElementById('retry-button');
    const scoreboard = document.getElementById('scoreboard');

    let userGesture = "unknown";
    let userScore = 0;
    let temiScore = 0;

    function classifyGesture(landmarks) {
      if (!landmarks) return "unknown";
      const fingerStates = [false, false, false, false, false];
      const tips = [4, 8, 12, 16, 20];

      for (let i = 1; i < tips.length; i++) {
        if (landmarks[tips[i]].y < landmarks[tips[i] - 2].y) {
          fingerStates[i] = true;
        }
      }

      const openFingers = fingerStates.filter(Boolean).length;
      if (openFingers === 0) return "rock";
      if (openFingers === 2) return "scissors";
      if (openFingers >= 4) return "paper";
      return "unknown";
    }

    function getGestureEmoji(gesture) {
      switch (gesture) {
        case "rock": return "âœŠ ë°”ìœ„";
        case "paper": return "âœ‹ ë³´";
        case "scissors": return "âœŒï¸ ê°€ìœ„";
        default: return "â“ ì¸ì‹ ì‹¤íŒ¨";
      }
    }

    function getTemiChoice() {
      const choices = ["rock", "paper", "scissors"];
      return choices[Math.floor(Math.random() * 3)];
    }

    function judgeGame(user, temi) {
      if (user === temi) return "draw";
      if (
        (user === "rock" && temi === "scissors") ||
        (user === "scissors" && temi === "paper") ||
        (user === "paper" && temi === "rock")
      ) return "user";
      return "temi";
    }

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'ko-KR';
      window.speechSynthesis.speak(utter);
    }

    function updateScore(result) {
      if (result === "user") userScore++;
      else if (result === "temi") temiScore++;
      scoreboard.textContent = `ğŸ‘¤ ë‹¹ì‹ : ${userScore}ìŠ¹ / ğŸ¤– í…Œë¯¸: ${temiScore}ìŠ¹`;
    }

    function startGame() {
      startButton.style.display = "none";
      retryButton.style.display = "none";
      gameArea.style.display = "block";
      resultOutput.textContent = "ğŸ¯ ê²°ê³¼: ëŒ€ê¸° ì¤‘...";
      countdownEl.textContent = "ì…‹ì„ ì„¸ë©´ ì‹œì‘í•©ë‹ˆë‹¤!";
      speak("ì…‹ì„ ì„¸ë©´ ê°€ìœ„ ë°”ìœ„ ë³´ë¥¼ í•˜ëŠ” ê±°ì˜ˆìš”");

      setTimeout(() => {
        countdownEl.textContent = "ê°€ìœ„!";
        speak("ê°€ìœ„!");
      }, 2000);
      setTimeout(() => {
        countdownEl.textContent = "ë°”ìœ„!";
        speak("ë°”ìœ„!");
      }, 4000);
      setTimeout(() => {
        countdownEl.textContent = "ë³´!";
        speak("ë³´!");
        const temiChoice = getTemiChoice();
        const result = judgeGame(userGesture, temiChoice);
        temiOutput.textContent = getGestureEmoji(temiChoice);

        let resultText = "";
        if (result === "user") resultText = "ğŸ‰ ë‹¹ì‹ ì´ ì´ê²¼ì–´ìš”!";
        else if (result === "temi") resultText = "ğŸ˜¢ í…Œë¯¸ê°€ ì´ê²¼ì–´ìš”!";
        else resultText = "ğŸ˜ ë¹„ê²¼ì–´ìš”!";

        resultOutput.textContent = "ğŸ¯ ê²°ê³¼: " + resultText;
        speak(resultText);
        updateScore(result);
        retryButton.style.display = "inline-block";
      }, 6000);
    }

    function retryGame() {
      userGesture = "unknown";
      startGame();
    }

    function onResults(results) {
      canvasCtx.save();
      canvasCtx.clearRect(0, 0, canvasElement.width, canvasElement.height);
      canvasCtx.drawImage(results.image, 0, 0, canvasElement.width, canvasElement.height);

      if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        const landmarks = results.multiHandLandmarks[0];
        drawConnectors(canvasCtx, landmarks, HAND_CONNECTIONS, {color: '#00FF00', lineWidth: 2});
        drawLandmarks(canvasCtx, landmarks, {color: '#FF0000', lineWidth: 1});
        userGesture = classifyGesture(landmarks);
        gestureOutput.textContent = "ğŸ– ë‹¹ì‹ ì˜ ì† ëª¨ì–‘: " + getGestureEmoji(userGesture);
      } else {
        gestureOutput.textContent = "ğŸ– ì†ì„ í™”ë©´ì— ë³´ì—¬ì£¼ì„¸ìš”.";
      }

      canvasCtx.restore();
    }

    const hands = new Hands({
      locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
    });
    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.7,
      minTrackingConfidence: 0.5
    });
    hands.onResults(onResults);

    const camera = new Camera(videoElement, {
      onFrame: async () => {
        await hands.send({image: videoElement});
      },
      width: 640,
      height: 480
    });
    camera.start();
  </script>
</body>
</html>
